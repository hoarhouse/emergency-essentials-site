<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://fonts.googleapis.com https://api.allorigins.win https://corsproxy.io https://api.codetabs.com https://geocoding-api.open-meteo.com https://earthquake.usgs.gov https://unpkg.com; connect-src 'self' https://fonts.googleapis.com https://api.allorigins.win https://corsproxy.io https://api.codetabs.com https://geocoding-api.open-meteo.com https://earthquake.usgs.gov https://unpkg.com https://*.tile.openstreetmap.org; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://unpkg.com; img-src 'self' data: https://*.tile.openstreetmap.org;">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <title>Earthquake Emergency Preparedness - EmergencyEssentials</title>
    <meta name="description" content="Comprehensive earthquake preparedness guide with seismic monitoring, safety strategies, and professional equipment recommendations.">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
           font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #000000;
            color: #FFFFFF;
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }
        
        /* Header */
        .header {
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 100;
            border-bottom: 1px solid #333333;
        }
        
        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }
        
        .logo {
            font-size: 28px;
            font-weight: 700;
            color: #FFFFFF;
            letter-spacing: -0.5px;
            text-decoration: none;
        }
        
        .nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
        }
        
        .nav-link {
            color: #CCCCCC;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: #FFFFFF;
        }
        
        /* Hero Section */
        .hero {
            text-align: center;
            padding: 120px 0;
            background: linear-gradient(180deg, #000000 0%, #111111 100%);
            position: relative;
        }
        
        .hero h1 {
            font-size: 72px;
            font-weight: 300;
            margin-bottom: 24px;
            letter-spacing: -2px;
            line-height: 1.1;
        }
        
        .hero p {
            font-size: 24px;
            color: #CCCCCC;
            max-width: 600px;
            margin: 0 auto 40px;
            font-weight: 300;
        }
        
        .threat-level {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: #1a1a1a;
            border: 1px solid #333333;
            padding: 16px 24px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .threat-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #FFAA44;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Real-Time Data Dashboard */
        .data-dashboard {
            background: #1a1a1a;
            border: 1px solid #333333;
            margin: 12px 0 8px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        .dashboard-header {
            background: #111111;
            padding: 20px 40px;
            border-bottom: 1px solid #333333;
        }

        .dashboard-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #FFFFFF;
        }

        .dashboard-subtitle {
            color: #CCCCCC;
            font-size: 14px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 0;
        }

        .data-card {
            background: #1a1a1a;
            border-right: 1px solid #333333;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .data-card:last-child {
            border-right: none;
        }

        .data-card:hover {
            background: #242424;
        }

        .data-label {
            font-size: 12px;
            color: #999999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .data-value {
            font-size: 32px;
            font-weight: 300;
            margin-bottom: 8px;
            line-height: 1;
        }

        .data-status {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .data-detail {
            font-size: 12px;
            color: #CCCCCC;
            line-height: 1.4;
        }

        /* Status Colors */
        .status-normal { color: #44AA44; }
        .status-watch { color: #FFDD44; }
        .status-warning { color: #FFAA44; }
        .status-critical { color: #FF4444; }

        .card-earthquakes .data-value { color: #FFAA44; }
        .card-largest .data-value { color: #FF4444; }
        .card-activity .data-value { color: #44AAFF; }
        .card-risk .data-value { color: #FFDD44; }

        /* Update indicator */
        .update-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #44AA44;
            animation: pulse 2s infinite;
        }

        .updating {
            background: #FFAA44;
        }

        .error {
            background: #FF4444;
            animation: none;
        }

        /* Recent Earthquakes List */
        .recent-earthquakes {
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 8px;
            padding: 8px;
            margin: 4px 0;
        }

        .earthquakes-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .earthquake-item {
            background: #161616;
            border: 1px solid #444444;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .earthquake-item:hover {
            background: #242424;
            border-color: #666666;
        }

        .earthquake-info {
            flex-grow: 1;
        }

        .earthquake-magnitude {
            font-size: 24px;
            font-weight: 600;
            margin-right: 20px;
            min-width: 60px;
            text-align: center;
        }

        .magnitude-1 { color: #44AA44; }
        .magnitude-2 { color: #FFDD44; }
        .magnitude-3 { color: #FFAA44; }
        .magnitude-4 { color: #FF4444; }

        .earthquake-details {
            margin-bottom: 4px;
        }

        .earthquake-location {
            font-weight: 500;
            color: #FFFFFF;
            margin-bottom: 4px;
        }

        .earthquake-meta {
            font-size: 12px;
            color: #CCCCCC;
        }

        .earthquake-distance {
            font-size: 14px;
            color: #999999;
            min-width: 80px;
            text-align: right;
        }

        /* Seismic Risk Assessment */
        .risk-assessment {
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 8px;
            padding: 8px;
            margin: 4px 0;
        }

        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .risk-card {
            background: #161616;
            border: 1px solid #444444;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .risk-card:hover {
            background: #242424;
            border-color: #666666;
            transform: translateY(-2px);
        }

        .risk-label {
            font-size: 14px;
            color: #CCCCCC;
            margin-bottom: 8px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .risk-value {
            font-size: 36px;
            font-weight: 300;
            color: #FFFFFF;
            margin-bottom: 4px;
            line-height: 1;
        }

        .risk-description {
            font-size: 14px;
            color: #999999;
            font-weight: 500;
        }

        .risk-low { color: #44AA44; }
        .risk-moderate { color: #FFDD44; }
        .risk-high { color: #FFAA44; }
        .risk-very-high { color: #FF4444; }

        /* Location Controls */
        .location-controls {
            background: #161616;
            border: 1px solid #444444;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .location-display {
            font-size: 16px;
            color: #CCCCCC;
            margin-bottom: 8px;
        }

        .city-selector {
            background: #1a1a1a;
            border: 1px solid #444444;
            border-radius: 4px;
            color: #FFFFFF;
            padding: 8px 12px;
            margin: 12px;
            font-size: 14px;
            min-width: 200px;
        }

        .city-selector:focus {
            border-color: #FFFFFF;
            outline: none;
        }

        .refresh-btn {
            background: transparent;
            border: 1px solid #FFFFFF;
            color: #FFFFFF;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 16px;
        }
        
        .refresh-btn:hover {
            background: #FFFFFF;
            color: #000000;
        }

        /* Equipment Grid */
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 12px;
        }
        
        .equipment-card {
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 8px;
            padding: 40px;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .equipment-card:hover {
            background: #2a2a2a;
            border-color: #555555;
            transform: translateY(-2px);
        }
        
        .equipment-priority {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .equipment-priority.critical {
            background: rgba(255, 68, 68, 0.1);
            color: #FF4444;
            border: 1px solid #FF4444;
        }
        
        .equipment-priority.important {
            background: rgba(255, 170, 68, 0.1);
            color: #FFAA44;
            border: 1px solid #FFAA44;
        }
        
        .equipment-priority.recommended {
            background: rgba(68, 170, 255, 0.1);
            color: #44AAFF;
            border: 1px solid #44AAFF;
        }
        
        .equipment-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 24px;
            stroke: #FFFFFF;
            stroke-width: 1.5;
            fill: none;
        }
        
        .equipment-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #FFFFFF;
        }
        
        .equipment-description {
            color: #CCCCCC;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .equipment-specs {
            font-size: 12px;
            color: #999999;
            background: #161616;
            padding: 12px;
            border-radius: 4px;
            border-left: 2px solid #333333;
        }
        
        .affiliate-link {
            display: inline-block;
            margin-top: 16px;
            background: #FF9900;
            color: #FFFFFF;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            transition: background 0.3s ease;
        }
        
        .affiliate-link:hover {
            background: #E68900;
        }

        /* Emergency Contacts */
        .emergency-contacts {
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 8px;
            padding: 12px;
            margin: 6px 0;
        }
        
        .contacts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }
        
        .contact-card {
            background: #161616;
            border: 1px solid #444444;
            border-radius: 8px;
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        .contact-card:hover {
            background: #242424;
            border-color: #666666;
        }
        
        .contact-type {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #999999;
            margin-bottom: 8px;
        }
        
        .contact-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #FFFFFF;
        }
        
        .contact-number {
            font-size: 20px;
            font-weight: 700;
            color: #FFFFFF;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
        }
        
        .contact-description {
            font-size: 14px;
            color: #CCCCCC;
            line-height: 1.5;
        }

        /* Call to Action */
        .cta-section {
            background: #FFFFFF;
            color: #000000;
            text-align: center;
            padding: 16px 8px;
            border-radius: 8px;
            margin: 8px 0;
        }
        
        .cta-title {
            font-size: 48px;
            font-weight: 300;
            margin-bottom: 16px;
            letter-spacing: -1px;
        }
        
        .cta-subtitle {
            font-size: 20px;
            margin-bottom: 32px;
            color: #666666;
            font-weight: 300;
        }
        
        .cta-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .cta-button {
            background: #000000;
            color: #FFFFFF;
            padding: 16px 32px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .cta-button:hover {
            background: #333333;
        }
        
        .cta-button.secondary {
            background: transparent;
            color: #000000;
            border: 1px solid #000000;
        }
        
        .cta-button.secondary:hover {
            background: #000000;
            color: #FFFFFF;
        }

        /* Section Styling */
        .section {
            padding: 12px 0;
        }
        
        .section-title {
            font-size: 56px;
            font-weight: 300;
            text-align: center;
            margin-bottom: 40px;
            color: #FFFFFF;
            letter-spacing: -1px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 48px;
            }
            
            .hero p {
                font-size: 18px;
            }
            
            .section-title {
                font-size: 36px;
            }
            
            .nav {
                flex-direction: column;
                gap: 20px;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .cta-title {
                font-size: 32px;
            }
            
            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .data-card {
                border-right: none;
                border-bottom: 1px solid #333333;
            }

            .data-card:last-child {
                border-bottom: none;
            }

            .earthquake-item {
                flex-direction: column;
                text-align: left;
            }

            .earthquake-magnitude {
                margin-right: 0;
                margin-bottom: 12px;
            }

            .earthquake-distance {
                text-align: left;
                margin-top: 8px;
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-in {
            animation: fadeIn 0.6s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <a href="index.html" class="logo">EmergencyEssentials</a>
               <div class="nav-links">
    <a href="index.html" class="nav-link">All Emergencies</a>
    <a href="wildfire.html" class="nav-link">Wildfire</a>
    <a href="flood.html" class="nav-link">Flood</a>
    <a href="earthquake.html" class="nav-link active">Earthquake</a>
    <a href="cyberattacks.html" class="nav-link">Cyberattacks</a>
</div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h1>Earthquake Preparedness</h1>
            <p>Comprehensive seismic safety strategies for earthquake-prone regions</p>
            <div class="threat-level">
                <div class="threat-indicator"></div>
                <span id="threat-level-text">Current Status: <strong>LOADING</strong> - Detecting location...</span>
            </div>
        </div>
    </section>

    <!-- Real-Time Data Dashboard -->
    <section class="section" style="padding: 8px 0;">
        <div class="container">
            <div class="data-dashboard">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">🌍 Live Seismic Activity Monitor</h2>
                    <p class="dashboard-subtitle">Real-time earthquake data for <span id="dashboard-location">detecting location...</span></p>
                </div>
                <div class="dashboard-grid">
                    <div class="data-card card-earthquakes">
                        <div class="update-indicator" id="earthquakes-indicator"></div>
                        <div class="data-label">Recent Earthquakes</div>
                        <div class="data-value" id="earthquakes-count">Loading...</div>
                        <div class="data-status" id="earthquakes-status">Scanning area...</div>
                        <div class="data-detail" id="earthquakes-detail">Last 7 days, magnitude 2.5+</div>
                    </div>
                    
                    <div class="data-card card-largest">
                        <div class="update-indicator" id="largest-indicator"></div>
                        <div class="data-label">Largest Recent</div>
                        <div class="data-value" id="largest-magnitude">Loading...</div>
                        <div class="data-status" id="largest-status">Checking activity...</div>
                        <div class="data-detail" id="largest-detail">Maximum magnitude this week</div>
                    </div>
                    
                    <div class="data-card card-activity">
                        <div class="update-indicator" id="activity-indicator"></div>
                        <div class="data-label">Activity Level</div>
                        <div class="data-value" id="activity-level">Loading...</div>
                        <div class="data-status" id="activity-status">Calculating...</div>
                        <div class="data-detail" id="activity-detail">Compared to normal patterns</div>
                    </div>
                    
                    <div class="data-card card-risk">
                        <div class="update-indicator" id="risk-indicator"></div>
                        <div class="data-label">Seismic Risk</div>
                        <div class="data-value" id="risk-level">Loading...</div>
                        <div class="data-status" id="risk-status">Assessing area...</div>
                        <div class="data-detail" id="risk-detail">Based on location & geology</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Interactive Earthquake Map -->
    <section class="section">
        <div class="container">
            <div class="recent-earthquakes">
                <h2 style="color: #FFFFFF; margin-bottom: 16px; font-weight: 300;">Live Earthquake Map</h2>
                <p style="color: #CCCCCC; margin-bottom: 20px;">Interactive map showing magnitude 2.5+ earthquakes from the <strong>last 7 days</strong> within 500 miles of your location. Click map to enable zoom/pan.</p>
                
                <div id="earthquake-map" style="width: 100%; height: 500px; background: #161616; border: 1px solid #444444; border-radius: 8px; position: relative; margin-bottom: 30px;">
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #CCCCCC;">
                        <div style="font-size: 18px; margin-bottom: 8px;">Loading earthquake map...</div>
                        <div style="color: #999999;">Initializing map and earthquake data</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Recent Earthquakes List -->
    <section class="section">
        <div class="container">
            <div class="recent-earthquakes">
                <h2 style="color: #FFFFFF; margin-bottom: 16px; font-weight: 300;">Recent Earthquakes Near You</h2>
                
                <div class="location-controls">
                    <div class="location-display">Monitoring: <span id="earthquakes-location">Detecting your location...</span></div>
                    <div class="location-display">Search Radius: <span id="search-radius">500 miles</span></div>
                    <select id="city-select" class="city-selector" onchange="updateContactsFromCitySelector()">
                        <option value="">Auto-detect location</option>
                        <option value="33.4484,-112.0740">Phoenix, AZ</option>
                        <option value="34.0522,-118.2437">Los Angeles, CA</option>
                        <option value="37.7749,-122.4194">San Francisco, CA</option>
                        <option value="38.5816,-121.4944">Sacramento, CA</option>
                        <option value="39.7392,-104.9903">Denver, CO</option>
                        <option value="41.2033,-77.1945">Pennsylvania</option>
                        <option value="43.6532,-116.3113">Boise, ID</option>
                        <option value="41.8781,-87.6298">Chicago, IL</option>
                        <option value="39.7817,-86.1478">Indianapolis, IN</option>
                        <option value="38.2904,-92.6390">Missouri</option>
                        <option value="46.8772,-96.7898">Fargo, ND</option>
                        <option value="36.1627,-86.7816">Nashville, TN</option>
                        <option value="30.2672,-97.7431">Austin, TX</option>
                        <option value="32.7767,-96.7970">Dallas, TX</option>
                        <option value="29.7604,-95.3698">Houston, TX</option>
                        <option value="40.7608,-111.8910">Salt Lake City, UT</option>
                        <option value="47.0379,-122.9015">Olympia, WA</option>
                        <option value="47.6062,-122.3321">Seattle, WA</option>
                    </select>
                </div>
                
                <div id="earthquakes-list" class="earthquakes-list">
                    <div style="text-align: center; padding: 40px; color: #CCCCCC;">
                        <div style="font-size: 18px; margin-bottom: 8px;">Loading recent earthquakes...</div>
                        <div style="color: #CCCCCC;">Fetching data from USGS earthquake monitoring network</div>
                    </div>
                </div>
                
                <button class="refresh-btn" onclick="refreshEarthquakeData()">Refresh Earthquake Data</button>
            </div>
        </div>
    </section>

    <!-- Seismic Risk Assessment -->
    <section class="section">
        <div class="container">
            <div class="risk-assessment">
                <h2 style="color: #FFFFFF; margin-bottom: 16px; font-weight: 300;">Regional Seismic Risk Assessment</h2>
                
                <div class="location-controls">
                    <div class="location-display">Assessment for: <span id="risk-location">Detecting your location...</span></div>
                </div>
                
                <div class="risk-grid">
                    <div class="risk-card">
                        <div class="risk-label">Peak Ground Acceleration</div>
                        <div class="risk-value risk-moderate" id="pga-risk">Loading...</div>
                        <div class="risk-description" id="pga-description">Estimated ground shaking</div>
                    </div>
                    
                    <div class="risk-card">
                        <div class="risk-label">Major Fault Distance</div>
                        <div class="risk-value risk-low" id="fault-distance">Loading...</div>
                        <div class="risk-description">Miles to nearest active fault</div>
                    </div>
                    
                    <div class="risk-card">
                        <div class="risk-label">Historical Activity</div>
                        <div class="risk-value risk-moderate" id="historical-activity">Loading...</div>
                        <div class="risk-description">Past 100 years regional data</div>
                    </div>
                    
                    <div class="risk-card">
                        <div class="risk-label">Soil Liquefaction</div>
                        <div class="risk-value risk-low" id="liquefaction-risk">Loading...</div>
                        <div class="risk-description">Ground stability assessment</div>
                    </div>
                </div>
                
                <button class="refresh-btn" onclick="refreshRiskAssessment()">Refresh Risk Assessment</button>
            </div>
        </div>
    </section>

    <!-- Earthquake Equipment -->
    <section class="section">
        <div class="container">
            <h2 class="section-title">Earthquake Safety Equipment</h2>
            <div class="equipment-grid">
                <div class="equipment-card">
                    <div class="equipment-priority critical">Critical</div>
                    <svg class="equipment-icon" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                    </svg>
                    <h3 class="equipment-title">Emergency Go-Bag</h3>
                    <p class="equipment-description">Portable 72-hour survival kit for immediate evacuation. Pre-packed with essentials for each family member, stored in accessible location.</p>
                    <div class="equipment-specs">
                        Specification: 72-hour supplies, waterproof bag, flashlight, first aid, emergency food & water
                    </div>
                    <a href="#" class="affiliate-link" onclick="trackAffiliate('emergency-go-bag', 'amazon')">View on Amazon - $129.99</a>
                </div>

                <div class="equipment-card">
                    <div class="equipment-priority critical">Critical</div>
                    <svg class="equipment-icon" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    <h3 class="equipment-title">Furniture Anchoring Kit</h3>
                    <p class="equipment-description">Secure tall furniture, appliances, and TVs to walls. Prevents tipping during earthquakes, reducing injury and escape route blockage.</p>
                    <div class="equipment-specs">
                        Specification: Wall anchors, safety straps, L-brackets, anti-tip fasteners for furniture up to 200lbs
                    </div>
                    <a href="#" class="affiliate-link" onclick="trackAffiliate('furniture-anchors', 'amazon')">View on Amazon - $34.99</a>
                </div>

                <div class="equipment-card">
                    <div class="equipment-priority critical">Critical</div>
                    <svg class="equipment-icon" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                    <h3 class="equipment-title">Emergency Lighting Kit</h3>
                    <p class="equipment-description">Battery-powered LED lanterns and flashlights for post-earthquake navigation. Essential when power grids fail after major seismic events.</p>
                    <div class="equipment-specs">
                        Specification: 400+ hour battery life, multiple brightness levels, shock-resistant, emergency beacon mode
                    </div>
                    <a href="#" class="affiliate-link" onclick="trackAffiliate('emergency-lighting', 'amazon')">View on Amazon - $59.99</a>
                </div>

                <div class="equipment-card">
                    <div class="equipment-priority important">Important</div>
                    <svg class="equipment-icon" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    <h3 class="equipment-title">Gas Shut-off Wrench</h3>
                    <p class="equipment-description">Essential tool for turning off gas main after earthquakes. Prevents gas leaks and potential fires when pipes may be damaged.</p>
                    <div class="equipment-specs">
                        Specification: Fits standard gas meter valves, steel construction, emergency instructions included
                    </div>
                    <a href="#" class="affiliate-link" onclick="trackAffiliate('gas-shutoff-wrench', 'amazon')">View on Amazon - $19.99</a>
                </div>

                <div class="equipment-card">
                    <div class="equipment-priority important">Important</div>
                    <svg class="equipment-icon" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-15.355 21.213 0"/>
                    </svg>
                    <h3 class="equipment-title">Emergency Radio</h3>
                    <p class="equipment-description">Hand-crank emergency radio for post-earthquake communication and updates. Solar/battery powered with NOAA weather alerts.</p>
                    <div class="equipment-specs">
                        Specification: NOAA weather alerts, hand-crank & solar charging, LED flashlight, USB phone charging
                    </div>
                    <a href="#" class="affiliate-link" onclick="trackAffiliate('emergency-radio', 'amazon')">View on Amazon - $39.99</a>
                </div>

                <div class="equipment-card">
                    <div class="equipment-priority recommended">Recommended</div>
                    <svg class="equipment-icon" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                    </svg>
                    <h3 class="equipment-title">Seismic Cabinet Latches</h3>
                    <p class="equipment-description">Automatic latches that secure cabinet doors during shaking. Prevents contents from spilling and blocking escape routes.</p>
                    <div class="equipment-specs">
                        Specification: Earthquake-activated latches, easy installation, works on most cabinet types
                    </div>
                    <a href="#" class="affiliate-link" onclick="trackAffiliate('cabinet-latches', 'amazon')">View on Amazon - $24.99</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Emergency Contacts -->
    <section class="section">
        <div class="container">
            <h2 class="section-title" id="emergency-contacts-title">Critical Emergency Contacts</h2>
            <div class="emergency-contacts">
                <div class="contacts-grid" id="emergency-contacts-grid">
                    <!-- Emergency contacts will be populated automatically based on location -->
                    <div style="text-align: center; padding: 40px; color: #CCCCCC;">
                        Loading emergency contacts for your location...
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Call to Action -->
    <section class="section">
        <div class="container">
            <div class="cta-section">
                <h2 class="cta-title">Create Your Earthquake Action Plan</h2>
                <p class="cta-subtitle">Generate a customized earthquake preparedness plan for your specific location and seismic risk</p>
                <div class="cta-buttons">
                    <button class="cta-button" onclick="generateEarthquakePlan()">Generate Plan</button>
                    <a href="#" class="cta-button secondary">Download Checklist</a>
                    <a href="#" class="cta-button secondary">Find Seismic Risk</a>
                </div>
            </div>
        </div>
    </section>

    <script>
        // =========================
        // GLOBAL VARIABLES
        // =========================
        let currentLatitude = null;
        let currentLongitude = null;
        let currentLocationName = "Unknown Location";
        let earthquakeData = [];
        let lastUpdateTime = null;
        let earthquakeMap = null;
        let mapMarkers = [];
        let userLocationMarker = null;
        let mapClickEnabled = false;

        // =========================
        // EMERGENCY CONTACTS DATABASE
        // =========================
        const EMERGENCY_CONTACTS_DB = {
            'phoenix_az': {
                cityName: 'Phoenix, AZ',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'Arizona Geological Survey', number: '(520) 621-7906', description: 'Earthquake information and geological hazard assessment' },
                    { type: 'Structural Safety', name: 'Maricopa County Building Safety', number: '(602) 506-3347', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'APS Emergency Line', number: '(855) 688-2437', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Arizona', number: '(602) 336-6660', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Maricopa County Emergency', number: '(602) 273-1411', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'los_angeles_ca': {
                cityName: 'Los Angeles, CA',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'CalTech Seismo Lab', number: '(626) 395-6811', description: 'Real-time earthquake information and aftershock predictions' },
                    { type: 'Structural Safety', name: 'LA Building & Safety', number: '(213) 482-7077', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'LADWP Emergency', number: '(800) 342-5397', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross LA', number: '(323) 739-5200', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'LA County Emergency', number: '(323) 881-2300', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'san_francisco_ca': {
                cityName: 'San Francisco, CA',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'USGS Earthquake Center', number: '(650) 329-4085', description: 'Official earthquake information and scientific data' },
                    { type: 'Structural Safety', name: 'SF Building Inspection', number: '(628) 652-3200', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'PG&E Emergency Line', number: '(800) 743-5000', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Bay Area', number: '(415) 427-8000', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'SF Emergency Management', number: '(415) 558-2700', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'sacramento_ca': {
                cityName: 'Sacramento, CA',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'California Geological Survey', number: '(916) 445-1923', description: 'State earthquake monitoring and geological assessment' },
                    { type: 'Structural Safety', name: 'Sacramento Building Inspection', number: '(916) 808-5704', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'SMUD Emergency Line', number: '(888) 456-7683', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Sacramento', number: '(916) 993-7070', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Sacramento County Emergency', number: '(916) 874-6851', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'denver_co': {
                cityName: 'Denver, CO',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'Colorado Geological Survey', number: '(303) 384-2850', description: 'Regional earthquake monitoring and geological hazards' },
                    { type: 'Structural Safety', name: 'Denver Building Inspection', number: '(720) 865-2500', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Xcel Energy', number: '(800) 895-1999', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Colorado', number: '(303) 722-7474', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Jefferson County Emergency', number: '(303) 277-0211', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'pennsylvania': {
                cityName: 'Pennsylvania',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'PA Geological Survey', number: '(717) 702-2017', description: 'Regional earthquake monitoring and geological assessment' },
                    { type: 'Structural Safety', name: 'PA Building Codes', number: '(717) 783-6302', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'PPL Electric Emergency', number: '(800) 342-5775', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross PA', number: '(717) 526-1681', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'PA Emergency Management', number: '(717) 651-2001', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'boise_id': {
                cityName: 'Boise, ID',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'University of Utah Seismo', number: '(801) 581-6274', description: 'Regional earthquake monitoring for Intermountain West' },
                    { type: 'Structural Safety', name: 'Ada County Building Safety', number: '(208) 287-5900', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Idaho Power Emergency', number: '(208) 388-2323', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Idaho', number: '(208) 375-0596', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Ada County Emergency', number: '(208) 577-4750', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'chicago_il': {
                cityName: 'Chicago, IL',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'Illinois State Geological Survey', number: '(217) 244-2414', description: 'Regional earthquake monitoring and geological assessment' },
                    { type: 'Structural Safety', name: 'Chicago Building Dept', number: '(312) 746-4100', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'ComEd Emergency Line', number: '(800) 334-7661', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Chicago', number: '(312) 729-6100', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Chicago Emergency Management', number: '(312) 746-5100', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'indianapolis_in': {
                cityName: 'Indianapolis, IN',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'Indiana Geological Survey', number: '(812) 855-7636', description: 'Regional earthquake monitoring and geological assessment' },
                    { type: 'Structural Safety', name: 'Marion County Building', number: '(317) 327-4622', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Indianapolis Power & Light', number: '(317) 261-8111', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Indiana', number: '(317) 684-7800', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Marion County Emergency', number: '(317) 327-3722', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'missouri': {
                cityName: 'Missouri',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'Missouri S&T Seismo Center', number: '(573) 341-4616', description: 'New Madrid seismic zone monitoring and earthquake information' },
                    { type: 'Structural Safety', name: 'MO Building Safety', number: '(573) 751-3333', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Ameren Missouri Emergency', number: '(800) 552-7583', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Missouri', number: '(314) 516-2700', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'MO Emergency Management', number: '(573) 526-9100', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'fargo_nd': {
                cityName: 'Fargo, ND',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'ND Geological Survey', number: '(701) 328-8000', description: 'Regional earthquake monitoring and geological assessment' },
                    { type: 'Structural Safety', name: 'Cass County Building', number: '(701) 241-5700', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Xcel Energy North Dakota', number: '(800) 895-1999', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Dakota', number: '(701) 232-7601', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Cass County Emergency', number: '(701) 241-5555', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'nashville_tn': {
                cityName: 'Nashville, TN',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'University of Memphis Seismo', number: '(901) 678-4929', description: 'New Madrid and regional earthquake monitoring' },
                    { type: 'Structural Safety', name: 'Metro Building Codes', number: '(615) 862-6590', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Nashville Electric Service', number: '(615) 736-6900', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Tennessee', number: '(615) 250-4300', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Davidson County Emergency', number: '(615) 862-8740', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'austin_tx': {
                cityName: 'Austin, TX',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'Texas Seismological Network', number: '(512) 471-0450', description: 'Regional earthquake monitoring and geological assessment' },
                    { type: 'Structural Safety', name: 'Austin Building Services', number: '(512) 978-4000', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Austin Energy Emergency', number: '(512) 322-9100', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Central Texas', number: '(512) 928-4271', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Travis County Emergency', number: '(512) 854-4050', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'dallas_tx': {
                cityName: 'Dallas, TX',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'SMU Seismological Observatory', number: '(214) 768-2750', description: 'North Texas earthquake monitoring and induced seismicity tracking' },
                    { type: 'Structural Safety', name: 'Dallas Building Inspection', number: '(214) 948-4480', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Oncor Emergency Line', number: '(888) 313-4747', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross North Texas', number: '(214) 678-8200', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Dallas County Emergency', number: '(214) 819-6300', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'houston_tx': {
                cityName: 'Houston, TX',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'Texas Seismological Network', number: '(512) 471-0450', description: 'Regional earthquake monitoring and induced seismicity tracking' },
                    { type: 'Structural Safety', name: 'Houston Building Dept', number: '(832) 394-8800', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'CenterPoint Energy Emergency', number: '(713) 207-2222', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Gulf Coast', number: '(713) 313-2700', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Harris County Emergency', number: '(713) 881-3100', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'salt_lake_city_ut': {
                cityName: 'Salt Lake City, UT',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'University of Utah Seismo', number: '(801) 581-6274', description: 'Wasatch fault monitoring and earthquake early warning' },
                    { type: 'Structural Safety', name: 'Salt Lake County Building', number: '(385) 468-6700', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Rocky Mountain Power Emergency', number: '(888) 221-7070', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Utah', number: '(801) 323-7000', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Salt Lake County Emergency', number: '(385) 468-6700', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'olympia_wa': {
                cityName: 'Olympia, WA',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'Pacific Northwest Seismic Network', number: '(206) 685-3811', description: 'Cascadia fault monitoring and earthquake early warning' },
                    { type: 'Structural Safety', name: 'Thurston County Building', number: '(360) 786-5490', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Puget Sound Energy Emergency', number: '(888) 225-5773', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Pacific Northwest', number: '(206) 323-2345', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'Thurston County Emergency', number: '(360) 754-2933', description: 'Evacuation routes and emergency coordination' }
                ]
            },
            'seattle_wa': {
                cityName: 'Seattle, WA',
                contacts: [
                    { type: 'Emergency Services', name: 'Fire Department', number: '911', description: 'For immediate life-threatening emergencies and seismic events' },
                    { type: 'Seismic Monitoring', name: 'Pacific Northwest Seismic Network', number: '(206) 685-3811', description: 'Cascadia fault monitoring and earthquake early warning' },
                    { type: 'Structural Safety', name: 'Seattle Building Dept', number: '(206) 684-8464', description: 'Post-earthquake building inspections and safety clearance' },
                    { type: 'Utilities Emergency', name: 'Seattle City Light Emergency', number: '(206) 684-3000', description: 'Report gas leaks, power lines down, or utility damage' },
                    { type: 'Red Cross Shelter', name: 'American Red Cross Puget Sound', number: '(206) 323-2345', description: 'Emergency shelter and disaster relief services' },
                    { type: 'Emergency Management', name: 'King County Emergency', number: '(206) 296-3830', description: 'Evacuation routes and emergency coordination' }
                ]
            }
        };

        // City coordinate to database key mapping
        const CITY_COORDINATES_TO_KEY = {
            '33.4484,-112.0740': 'phoenix_az',
            '34.0522,-118.2437': 'los_angeles_ca',
            '37.7749,-122.4194': 'san_francisco_ca',
            '38.5816,-121.4944': 'sacramento_ca',
            '39.7392,-104.9903': 'denver_co',
            '41.2033,-77.1945': 'pennsylvania',
            '43.6532,-116.3113': 'boise_id',
            '41.8781,-87.6298': 'chicago_il',
            '39.7817,-86.1478': 'indianapolis_in',
            '38.2904,-92.6390': 'missouri',
            '46.8772,-96.7898': 'fargo_nd',
            '36.1627,-86.7816': 'nashville_tn',
            '30.2672,-97.7431': 'austin_tx',
            '32.7767,-96.7970': 'dallas_tx',
            '29.7604,-95.3698': 'houston_tx',
            '40.7608,-111.8910': 'salt_lake_city_ut',
            '47.0379,-122.9015': 'olympia_wa',
            '47.6062,-122.3321': 'seattle_wa'
        };

        // =========================
        // EARTHQUAKE MAP FUNCTIONS
        // =========================

        /**
         * Initializes the Leaflet earthquake map
         */
        function initializeEarthquakeMap() {
            console.log('[MAP] Initializing earthquake map...');
            
            if (!currentLatitude || !currentLongitude) {
                console.log('[MAP] No coordinates available for map initialization');
                return;
            }

            try {
                // Initialize map centered on user location
                earthquakeMap = L.map('earthquake-map', {
                    center: [currentLatitude, currentLongitude],
                    zoom: 7,
                    scrollWheelZoom: false, // Disable scroll zoom initially
                    doubleClickZoom: false, // Disable double-click zoom initially
                    dragging: false, // Disable dragging initially
                    touchZoom: false, // Disable touch zoom initially
                    boxZoom: false, // Disable box zoom
                    keyboard: false // Disable keyboard navigation
                });

                // Add tile layer (using OpenStreetMap)
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap contributors',
                    maxZoom: 18
                }).addTo(earthquakeMap);

                // Add click handler to enable interactions
                earthquakeMap.on('click', enableMapInteractions);

                // Add overlay message
                addMapOverlay();

                // Add user location marker
                addUserLocationMarker();

                // Add earthquake markers
                updateEarthquakeMarkers();

                console.log('[MAP] Earthquake map initialized successfully');

            } catch (error) {
                console.error('[MAP] Error initializing map:', error);
                showMapError();
            }
        }

        /**
         * Adds overlay message to inform users to click to interact
         */
        function addMapOverlay() {
            const mapContainer = document.getElementById('earthquake-map');
            
            const overlay = document.createElement('div');
            overlay.id = 'map-overlay';
            overlay.style.cssText = `
                position: absolute;
                top: 10px;
                left: 10px;
                right: 10px;
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 12px;
                border-radius: 6px;
                font-size: 14px;
                text-align: center;
                z-index: 1000;
                pointer-events: none;
                border: 1px solid #444;
            `;
            overlay.innerHTML = '🗺️ Click map to enable zoom and pan • Last 7 days, magnitude 2.5+ within 500 miles';
            
            mapContainer.appendChild(overlay);
        }

        /**
         * Enables map interactions when clicked
         */
        function enableMapInteractions() {
            if (mapClickEnabled) return;
            
            console.log('[MAP] Enabling map interactions');
            mapClickEnabled = true;

            // Enable all interactions
            earthquakeMap.scrollWheelZoom.enable();
            earthquakeMap.doubleClickZoom.enable();
            earthquakeMap.dragging.enable();
            earthquakeMap.touchZoom.enable();
            earthquakeMap.boxZoom.enable();
            earthquakeMap.keyboard.enable();

            // Update overlay message
            const overlay = document.getElementById('map-overlay');
            if (overlay) {
                overlay.innerHTML = '🗺️ Map interactions enabled • Zoom and pan freely';
                overlay.style.background = 'rgba(68, 170, 68, 0.8)';
                
                // Hide overlay after 3 seconds
                setTimeout(() => {
                    if (overlay) overlay.style.display = 'none';
                }, 3000);
            }
        }

        /**
         * Adds user location marker to map
         */
        function addUserLocationMarker() {
            if (!earthquakeMap || !currentLatitude || !currentLongitude) return;

            // Remove existing user marker
            if (userLocationMarker) {
                earthquakeMap.removeLayer(userLocationMarker);
            }

            // Create custom icon for user location
            const userIcon = L.divIcon({
                html: `<div style="
                    width: 20px; 
                    height: 20px; 
                    background: #44AAFF; 
                    border: 3px solid white; 
                    border-radius: 50%; 
                    box-shadow: 0 0 10px rgba(68, 170, 255, 0.5);
                "></div>`,
                className: 'user-location-marker',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });

            userLocationMarker = L.marker([currentLatitude, currentLongitude], {
                icon: userIcon
            }).addTo(earthquakeMap);

            userLocationMarker.bindPopup(`
                <div style="color: black; font-weight: bold;">
                    📍 Your Location<br>
                    <small>${currentLocationName}</small>
                </div>
            `);

            console.log('[MAP] User location marker added');
        }

        /**
         * Updates earthquake markers on the map
         */
        function updateEarthquakeMarkers() {
            if (!earthquakeMap) return;

            console.log('[MAP] Updating earthquake markers...');
            console.log(`[MAP] Available earthquake data: ${earthquakeData.length} events`);

            // Remove existing earthquake markers
            mapMarkers.forEach(marker => earthquakeMap.removeLayer(marker));
            mapMarkers = [];

            if (earthquakeData.length === 0) {
                console.log('[MAP] No earthquake data available for markers');
                return;
            }

            // Add new markers for each earthquake
            earthquakeData.forEach((earthquake, index) => {
                const coords = earthquake.geometry.coordinates;
                const props = earthquake.properties;
                const lat = coords[1];
                const lon = coords[0];
                const mag = props.mag;
                const place = props.place;
                const time = new Date(props.time);
                const depth = coords[2];

                console.log(`[MAP] Adding marker ${index + 1}: Mag ${mag} at ${place}`);

                // Create marker with size/color based on magnitude
                const markerSize = Math.max(12, Math.min(35, mag * 7));
                const markerColor = getMagnitudeColor(mag);

                const earthquakeIcon = L.divIcon({
                    html: `<div style="
                        width: ${markerSize}px; 
                        height: ${markerSize}px; 
                        background: ${markerColor}; 
                        border: 2px solid white; 
                        border-radius: 50%; 
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: ${Math.max(10, markerSize * 0.35)}px;
                        font-weight: bold;
                        color: white;
                        text-shadow: 1px 1px 1px rgba(0,0,0,0.7);
                        box-shadow: 0 2px 8px rgba(0,0,0,0.4);
                    ">${mag.toFixed(1)}</div>`,
                    className: 'earthquake-marker',
                    iconSize: [markerSize, markerSize],
                    iconAnchor: [markerSize/2, markerSize/2]
                });

                const marker = L.marker([lat, lon], {
                    icon: earthquakeIcon
                }).addTo(earthquakeMap);

                // Create popup with earthquake details
                const distance = calculateDistance(currentLatitude, currentLongitude, lat, lon);
                marker.bindPopup(`
                    <div style="color: black; min-width: 200px;">
                        <div style="font-weight: bold; font-size: 16px; margin-bottom: 8px;">
                            Magnitude ${mag.toFixed(1)} Earthquake
                        </div>
                        <div style="margin-bottom: 4px;"><strong>Location:</strong> ${place}</div>
                        <div style="margin-bottom: 4px;"><strong>Time:</strong> ${time.toLocaleString()}</div>
                        <div style="margin-bottom: 4px;"><strong>Depth:</strong> ${depth.toFixed(1)} km</div>
                        <div style="margin-bottom: 4px;"><strong>Distance:</strong> ${distance.toFixed(0)} miles from you</div>
                        <div style="font-size: 12px; color: #666; margin-top: 8px;">
                            Source: USGS Earthquake Hazards Program
                        </div>
                    </div>
                `);

                mapMarkers.push(marker);
            });

            console.log(`[MAP] Successfully added ${mapMarkers.length} earthquake markers to map`);
            
            // Force map to refresh/redraw
            setTimeout(() => {
                if (earthquakeMap) {
                    earthquakeMap.invalidateSize();
                }
            }, 100);
        }

        /**
         * Gets marker color based on earthquake magnitude
         */
        function getMagnitudeColor(magnitude) {
            if (magnitude >= 5.0) return '#FF4444'; // Red - Strong
            if (magnitude >= 4.0) return '#FFAA44'; // Orange - Moderate  
            if (magnitude >= 3.0) return '#FFDD44'; // Yellow - Light
            return '#44AA44'; // Green - Minor
        }

        /**
         * Shows map error message
         */
        function showMapError() {
            const mapContainer = document.getElementById('earthquake-map');
            mapContainer.innerHTML = `
                <div style="
                    position: absolute; 
                    top: 50%; 
                    left: 50%; 
                    transform: translate(-50%, -50%); 
                    text-align: center; 
                    color: #CCCCCC;
                ">
                    <div style="font-size: 18px; margin-bottom: 8px; color: #FF4444;">
                        ⚠️ Map Failed to Load
                    </div>
                    <div style="color: #999999;">
                        Unable to initialize earthquake map.<br>
                        Please check your internet connection.
                    </div>
                </div>
            `;
        }

        // =========================
        // EARTHQUAKE API FUNCTIONS (UPDATED FOR MAP)
        // =========================

        /**
         * Fetches earthquake data from USGS API (500 mile radius)
         */
        async function fetchEarthquakeData() {
            if (!currentLatitude || !currentLongitude) {
                console.log('[DEBUG] No coordinates available for earthquake fetch');
                return [];
            }

            const radiusKm = 804; // ~500 miles
            const minMagnitude = 2.5;
            const endtime = new Date().toISOString();
            const starttime = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(); // 7 days ago

            // USGS API endpoint for earthquakes
            const apiUrl = `https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&latitude=${currentLatitude}&longitude=${currentLongitude}&maxradiuskm=${radiusKm}&minmagnitude=${minMagnitude}&starttime=${starttime}&endtime=${endtime}&orderby=magnitude`;

            try {
                console.log(`[API] Fetching earthquakes from: ${apiUrl}`);
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log(`[API] Received ${data.features?.length || 0} earthquakes`);
                
                return data.features || [];
            } catch (error) {
                console.error('[API] Error fetching earthquake data:', error);
                
                // Return mock data for testing
                return generateMockEarthquakeData();
            }
        }

        /**
         * Generates mock earthquake data for testing
         */
        function generateMockEarthquakeData() {
            const mockData = [
                {
                    properties: {
                        mag: 3.2,
                        place: "15km NE of Boulder, Colorado",
                        time: Date.now() - 2 * 60 * 60 * 1000, // 2 hours ago
                        type: "earthquake"
                    },
                    geometry: {
                        coordinates: [-105.1, 40.1, 5.2]
                    }
                },
                {
                    properties: {
                        mag: 2.8,
                        place: "8km SW of Golden, Colorado",
                        time: Date.now() - 1 * 24 * 60 * 60 * 1000, // 1 day ago
                        type: "earthquake"
                    },
                    geometry: {
                        coordinates: [-105.3, 39.7, 8.1]
                    }
                },
                {
                    properties: {
                        mag: 4.1,
                        place: "22km E of Denver, Colorado",
                        time: Date.now() - 3 * 24 * 60 * 60 * 1000, // 3 days ago
                        type: "earthquake"
                    },
                    geometry: {
                        coordinates: [-104.7, 39.8, 12.5]
                    }
                }
            ];
            
            console.log('[MOCK] Using mock earthquake data');
            return mockData;
        }

        /**
         * Calculates distance between two coordinates in miles
         */
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3959; // Earth's radius in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        /**
         * Formats time ago string
         */
        function timeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return `${days}d ago`;
        }

        /**
         * Gets magnitude color class
         */
        function getMagnitudeClass(magnitude) {
            if (magnitude >= 5.0) return 'magnitude-4';
            if (magnitude >= 4.0) return 'magnitude-3';
            if (magnitude >= 3.0) return 'magnitude-2';
            return 'magnitude-1';
        }

        /**
         * Updates the earthquake dashboard with live data
         */
        async function updateEarthquakeDashboard() {
            console.log('[DASHBOARD] Updating earthquake dashboard...');
            
            // Set loading state
            setIndicatorState('earthquakes-indicator', 'updating');
            setIndicatorState('largest-indicator', 'updating');
            setIndicatorState('activity-indicator', 'updating');
            
            try {
                // Use the global earthquakeData that was already fetched
                console.log(`[DASHBOARD] Using ${earthquakeData.length} earthquakes for dashboard`);
                
                // Update earthquake count
                const count = earthquakeData.length;
                document.getElementById('earthquakes-count').textContent = count;
                document.getElementById('earthquakes-status').textContent = 
                    count === 0 ? 'No recent activity' : 
                    count < 5 ? 'Low activity' : 
                    count < 15 ? 'Moderate activity' : 'High activity';
                
                // Update largest magnitude
                const largestMag = earthquakeData.length > 0 ? 
                    Math.max(...earthquakeData.map(eq => eq.properties.mag)) : 0;
                document.getElementById('largest-magnitude').textContent = 
                    largestMag > 0 ? largestMag.toFixed(1) : 'None';
                document.getElementById('largest-status').textContent = 
                    largestMag < 3.0 ? 'Minor' : 
                    largestMag < 4.0 ? 'Light' : 
                    largestMag < 5.0 ? 'Moderate' : 'Strong';
                
                // Update activity level
                const activityLevel = count < 5 ? 'Low' : count < 15 ? 'Normal' : 'Elevated';
                document.getElementById('activity-level').textContent = activityLevel;
                document.getElementById('activity-status').textContent = 
                    `${count} events detected`;
                
                // Set success state
                setIndicatorState('earthquakes-indicator', 'success');
                setIndicatorState('largest-indicator', 'success');
                setIndicatorState('activity-indicator', 'success');
                
                console.log(`[DASHBOARD] Updated with ${count} earthquakes`);
                
            } catch (error) {
                console.error('[DASHBOARD] Error updating dashboard:', error);
                
                // Set error state
                setIndicatorState('earthquakes-indicator', 'error');
                setIndicatorState('largest-indicator', 'error');
                setIndicatorState('activity-indicator', 'error');
                
                document.getElementById('earthquakes-count').textContent = 'Error';
                document.getElementById('largest-magnitude').textContent = 'Error';
                document.getElementById('activity-level').textContent = 'Error';
            }
        }

        /**
         * Updates the recent earthquakes list
         */
        function updateEarthquakesList() {
            const listContainer = document.getElementById('earthquakes-list');
            
            if (!earthquakeData || earthquakeData.length === 0) {
                listContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #CCCCCC;">
                        <div style="font-size: 18px; margin-bottom: 8px;">No recent earthquakes detected</div>
                        <div style="color: #CCCCCC;">No magnitude 2.5+ earthquakes in the past 7 days within 500 miles</div>
                    </div>
                `;
                return;
            }
            
            // Sort by magnitude (largest first)
            const sortedEarthquakes = [...earthquakeData].sort((a, b) => 
                b.properties.mag - a.properties.mag
            );
            
            const earthquakesHTML = sortedEarthquakes.map(earthquake => {
                const mag = earthquake.properties.mag;
                const place = earthquake.properties.place;
                const time = earthquake.properties.time;
                const coords = earthquake.geometry.coordinates;
                const distance = calculateDistance(
                    currentLatitude, currentLongitude, 
                    coords[1], coords[0]
                );
                
                return `
                    <div class="earthquake-item">
                        <div class="earthquake-magnitude ${getMagnitudeClass(mag)}">
                            ${mag.toFixed(1)}
                        </div>
                        <div class="earthquake-info">
                            <div class="earthquake-location">${place}</div>
                            <div class="earthquake-meta">
                                ${timeAgo(time)} • Depth: ${coords[2].toFixed(1)}km
                            </div>
                        </div>
                        <div class="earthquake-distance">
                            ${distance.toFixed(0)} mi
                        </div>
                    </div>
                `;
            }).join('');
            
            listContainer.innerHTML = earthquakesHTML;
            console.log(`[LIST] Updated earthquakes list with ${sortedEarthquakes.length} items`);
        }

        /**
         * Updates seismic risk assessment
         */
        function updateSeismicRisk() {
            console.log('[RISK] Updating seismic risk assessment...');
            
            setIndicatorState('risk-indicator', 'updating');
            
            // Generate risk assessment based on location
            const riskData = generateSeismicRiskAssessment();
            
            document.getElementById('pga-risk').textContent = riskData.pga;
            document.getElementById('pga-risk').className = `risk-value ${riskData.pgaClass}`;
            document.getElementById('pga-description').textContent = riskData.pgaDesc;
            
            document.getElementById('fault-distance').textContent = riskData.faultDistance;
            document.getElementById('fault-distance').className = `risk-value ${riskData.faultClass}`;
            
            document.getElementById('historical-activity').textContent = riskData.historical;
            document.getElementById('historical-activity').className = `risk-value ${riskData.historicalClass}`;
            
            document.getElementById('liquefaction-risk').textContent = riskData.liquefaction;
            document.getElementById('liquefaction-risk').className = `risk-value ${riskData.liquefactionClass}`;
            
            setIndicatorState('risk-indicator', 'success');
            
            console.log('[RISK] Risk assessment updated');
        }

        /**
         * Generates seismic risk assessment based on location
         */
        function generateSeismicRiskAssessment() {
            // This would normally use real geological data APIs
            // For now, we'll generate realistic assessments based on known seismic zones
            
            const lat = currentLatitude;
            const lon = currentLongitude;
            
            // California (high risk)
            if (lat >= 32 && lat <= 42 && lon >= -125 && lon <= -114) {
                return {
                    pga: '0.8g',
                    pgaClass: 'risk-very-high',
                    pgaDesc: 'Very high ground shaking potential',
                    faultDistance: '12 mi',
                    faultClass: 'risk-high',
                    historical: 'High',
                    historicalClass: 'risk-high',
                    liquefaction: 'High',
                    liquefactionClass: 'risk-high'
                };
            }
            
            // Pacific Northwest (high risk)
            if (lat >= 42 && lat <= 49 && lon >= -125 && lon <= -116) {
                return {
                    pga: '0.6g',
                    pgaClass: 'risk-high',
                    pgaDesc: 'High ground shaking potential',
                    faultDistance: '45 mi',
                    faultClass: 'risk-moderate',
                    historical: 'Moderate',
                    historicalClass: 'risk-moderate',
                    liquefaction: 'High',
                    liquefactionClass: 'risk-high'
                };
            }
            
            // New Madrid Seismic Zone (moderate risk)
            if (lat >= 35 && lat <= 40 && lon >= -92 && lon <= -88) {
                return {
                    pga: '0.4g',
                    pgaClass: 'risk-moderate',
                    pgaDesc: 'Moderate ground shaking potential',
                    faultDistance: '78 mi',
                    faultClass: 'risk-moderate',
                    historical: 'Moderate',
                    historicalClass: 'risk-moderate',
                    liquefaction: 'Moderate',
                    liquefactionClass: 'risk-moderate'
                };
            }
            
            // Intermountain West (moderate risk)
            if (lat >= 37 && lat <= 45 && lon >= -117 && lon <= -108) {
                return {
                    pga: '0.3g',
                    pgaClass: 'risk-moderate',
                    pgaDesc: 'Moderate ground shaking potential',
                    faultDistance: '35 mi',
                    faultClass: 'risk-moderate',
                    historical: 'Low',
                    historicalClass: 'risk-low',
                    liquefaction: 'Low',
                    liquefactionClass: 'risk-low'
                };
            }
            
            // Default (low risk)
            return {
                pga: '0.1g',
                pgaClass: 'risk-low',
                pgaDesc: 'Low ground shaking potential',
                faultDistance: '150+ mi',
                faultClass: 'risk-low',
                historical: 'Very Low',
                historicalClass: 'risk-low',
                liquefaction: 'Very Low',
                liquefactionClass: 'risk-low'
            };
        }

        /**
         * Sets indicator state (updating, success, error)
         */
        function setIndicatorState(indicatorId, state) {
            const indicator = document.getElementById(indicatorId);
            if (!indicator) return;
            
            indicator.className = 'update-indicator';
            if (state === 'updating') {
                indicator.classList.add('updating');
            } else if (state === 'error') {
                indicator.classList.add('error');
            }
            // success uses default green color
        }

        /**
         * Updates location display elements
         */
        function updateLocationDisplay(locationName) {
            const elements = [
                'dashboard-location',
                'earthquakes-location', 
                'risk-location'
            ];
            
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = locationName;
                }
            });
            
            // Update threat level
            const threatLevel = document.getElementById('threat-level-text');
            if (threatLevel) {
                threatLevel.innerHTML = `Current Status: <strong>MONITORING</strong> - ${locationName}`;
            }
        }

        /**
         * Updates all earthquake data and displays
         */
        async function updateAllData() {
            console.log('[UPDATE] Updating all earthquake data...');
            
            updateLocationDisplay(currentLocationName);
            
            // Fetch earthquake data first
            console.log('[UPDATE] Fetching fresh earthquake data...');
            earthquakeData = await fetchEarthquakeData();
            console.log(`[UPDATE] Fetched ${earthquakeData.length} earthquakes`);
            
            // Update all displays with the same data
            updateEarthquakeDashboard();
            updateEarthquakesList();
            updateSeismicRisk();
            
            // Update map if it exists
            if (earthquakeMap) {
                console.log('[UPDATE] Updating map with earthquake data...');
                updateEarthquakeMarkers();
            } else {
                // Initialize map if coordinates are available
                if (currentLatitude && currentLongitude) {
                    console.log('[UPDATE] Initializing map...');
                    initializeEarthquakeMap();
                }
            }
            
            lastUpdateTime = new Date();
            console.log('[UPDATE] All data updated successfully');
        }

        // =========================
        // GEOLOCATION FUNCTIONS
        // =========================

        /**
         * Gets user's current location
         */
        function getCurrentLocation() {
            console.log('[LOCATION] Requesting user location...');
            
            if (!navigator.geolocation) {
                console.error('[LOCATION] Geolocation not supported');
                useDefaultLocation();
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    currentLatitude = position.coords.latitude;
                    currentLongitude = position.coords.longitude;
                    console.log(`[LOCATION] Got coordinates: ${currentLatitude}, ${currentLongitude}`);
                    
                    reverseGeocode(currentLatitude, currentLongitude);
                },
                (error) => {
                    console.error('[LOCATION] Geolocation error:', error);
                    useDefaultLocation();
                },
                {
                    timeout: 10000,
                    enableHighAccuracy: false
                }
            );
        }

        /**
         * Reverse geocodes coordinates to get city name
         */
        async function reverseGeocode(lat, lon) {
            try {
                // Using a free geocoding service
                const response = await fetch(
                    `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&count=1`
                );
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.results && data.results.length > 0) {
                        const result = data.results[0];
                        currentLocationName = `${result.name || result.admin1 || 'Unknown'}, ${result.country_code || ''}`;
                    }
                }
            } catch (error) {
                console.error('[GEOCODE] Error reverse geocoding:', error);
            }
            
            console.log(`[GEOCODE] Location name: ${currentLocationName}`);
            
            // Initialize emergency contacts
            initializeEmergencyContacts(lat, lon);
            
            // Update all data
            updateAllData();
        }

        /**
         * Uses default location (Denver, CO)
         */
        function useDefaultLocation() {
            currentLatitude = 39.7392;
            currentLongitude = -104.9903;
            currentLocationName = "Denver, CO (Default)";
            
            console.log('[LOCATION] Using default location: Denver, CO');
            
            // Initialize emergency contacts
            initializeEmergencyContacts(currentLatitude, currentLongitude);
            
            // Update all data
            updateAllData();
        }

        // =========================
        // EMERGENCY CONTACTS FUNCTIONS
        // =========================

        /**
         * Updates emergency contacts based on selected city
         */
        function updateEmergencyContacts(cityKey, containerId = 'emergency-contacts-grid') {
            console.log(`[DEBUG] updateEmergencyContacts called with cityKey: ${cityKey}`);
            
            const contacts = EMERGENCY_CONTACTS_DB[cityKey];
            const container = document.getElementById(containerId);
            
            if (!contacts) {
                console.error(`[ERROR] No contacts found for cityKey: ${cityKey}`);
                return;
            }
            
            if (!container) {
                console.error(`[ERROR] Container not found: ${containerId}`);
                return;
            }
            
            // Generate contacts grid HTML
            const contactsHTML = contacts.contacts.map(contact => `
                <div class="contact-card">
                    <div class="contact-type">${contact.type}</div>
                    <div class="contact-name">${contact.name}</div>
                    <div class="contact-number">${contact.number}</div>
                    <div class="contact-description">${contact.description}</div>
                </div>
            `).join('');
            
            // Update the container
            container.innerHTML = contactsHTML;
            
            // Update page title if element exists
            const titleElement = document.getElementById('emergency-contacts-title');
            if (titleElement) {
                titleElement.textContent = `Emergency Contacts - ${contacts.cityName}`;
            }
            
            console.log(`[SUCCESS] Emergency contacts updated for ${contacts.cityName}`);
        }

        /**
         * Gets city key from coordinates (for auto-detected location)
         */
        function getCityKeyFromCoordinates(lat, lon) {
            // Find closest city from our database
            let closestCity = null;
            let minDistance = Infinity;
            
            Object.entries(CITY_COORDINATES_TO_KEY).forEach(([coords, key]) => {
                const [cityLat, cityLon] = coords.split(',').map(Number);
                const distance = Math.sqrt(
                    Math.pow(lat - cityLat, 2) + Math.pow(lon - cityLon, 2)
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    closestCity = key;
                }
            });
            
            // Only return if within reasonable distance (about 2 degrees)
            return minDistance < 2 ? closestCity : 'denver_co'; // Default to Denver
        }

        /**
         * Initialize emergency contacts with auto-detected location
         */
        function initializeEmergencyContacts(lat, lon) {
            const cityKey = getCityKeyFromCoordinates(lat, lon);
            updateEmergencyContacts(cityKey);
        }

        /**
         * Updates emergency contacts when city selector changes
         */
        function updateContactsFromCitySelector() {
            const citySelect = document.getElementById('city-select');
            if (!citySelect || !citySelect.value) {
                // If auto-detect is selected, use current location
                if (currentLatitude && currentLongitude) {
                    const cityKey = getCityKeyFromCoordinates(currentLatitude, currentLongitude);
                    if (cityKey) {
                        updateEmergencyContacts(cityKey);
                    }
                }
                return;
            }
            
            const cityKey = CITY_COORDINATES_TO_KEY[citySelect.value];
            if (cityKey) {
                updateEmergencyContacts(cityKey);
                
                // Update the location for earthquake data
                const [lat, lon] = citySelect.value.split(',').map(Number);
                currentLatitude = lat;
                currentLongitude = lon;
                
                // Get city name from database
                const contacts = EMERGENCY_CONTACTS_DB[cityKey];
                if (contacts) {
                    currentLocationName = contacts.cityName;
                    updateLocationDisplay(currentLocationName);
                    
                    // Update map location and reset interactions
                    updateMapLocation(lat, lon);
                    
                    // Update all data
                    updateAllData();
                }
            }
        }

        /**
         * Updates map center and user location when city changes
         */
        function updateMapLocation(lat, lon) {
            if (!earthquakeMap) {
                console.log('[MAP] Map not initialized, will update when created');
                return;
            }

            console.log(`[MAP] Updating map location to: ${lat}, ${lon}`);
            
            // Reset map interactions
            mapClickEnabled = false;
            earthquakeMap.scrollWheelZoom.disable();
            earthquakeMap.doubleClickZoom.disable();
            earthquakeMap.dragging.disable();
            earthquakeMap.touchZoom.disable();
            earthquakeMap.boxZoom.disable();
            earthquakeMap.keyboard.disable();

            // Update map center with smooth animation
            earthquakeMap.setView([lat, lon], 7, {
                animate: true,
                duration: 1
            });

            // Update user location marker
            addUserLocationMarker();

            // Reset overlay message
            const overlay = document.getElementById('map-overlay');
            if (overlay) {
                overlay.innerHTML = '🗺️ Click map to enable zoom and pan • Last 7 days, magnitude 2.5+ within 500 miles';
                overlay.style.background = 'rgba(0, 0, 0, 0.8)';
                overlay.style.display = 'block';
            }

            console.log('[MAP] Map location updated successfully');
        }

        // =========================
        // USER ACTION FUNCTIONS
        // =========================

        /**
         * Refreshes earthquake data manually
         */
        async function refreshEarthquakeData() {
            console.log('[REFRESH] Manual refresh requested');
            await updateAllData();
        }

        /**
         * Refreshes risk assessment manually
         */
        function refreshRiskAssessment() {
            console.log('[REFRESH] Risk assessment refresh requested');
            updateSeismicRisk();
        }

        /**
         * Generates earthquake preparedness plan
         */
        function generateEarthquakePlan() {
            alert(`Earthquake preparedness plan for ${currentLocationName} would be generated here. This feature is coming soon!`);
        }

        /**
         * Tracks affiliate link clicks
         */
        function trackAffiliate(product, platform) {
            console.log(`[AFFILIATE] Clicked: ${product} on ${platform}`);
            // Would normally track analytics here
        }

        // =========================
        // INITIALIZATION
        // =========================

        /**
         * Initialize the earthquake monitoring system
         */
        function initializeEarthquakeMonitoring() {
            console.log('[INIT] Initializing earthquake monitoring system...');
            
            // Start location detection
            getCurrentLocation();
            
            // Set up periodic updates (every 5 minutes)
            setInterval(updateAllData, 5 * 60 * 1000);
            
            console.log('[INIT] Earthquake monitoring system initialized');
        }

        // Start the system when page loads
        document.addEventListener('DOMContentLoaded', initializeEarthquakeMonitoring);
    </script>
</body>
</html>